---
// Toast
// ------------
// Description: The toast component is a user interface element that displays brief,
// informative messages to users. It is typically used to provide feedback or
// toasts about the status of an action or to display important information.
// Reference: https://wind-ui.com/components/notifications/
---

<div id="foxi-toast" class="toast" style="display: none">
	<div class="toast__container" role="status">
		<!-- Heading with close button -->
		<div class="toast__heading">
			<!-- Headline -->
			<h3 class="toast__headline">Ready to go bigger?</h3>
			<!-- Close button -->
			<button aria-label="Close" class="toast__close-button" id="foxi-toast-close">
				<span class="toast__close-button-icon">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						class="h-4 w-4"
						fill="none"
						viewBox="0 0 24 24"
						stroke="currentColor"
						stroke-width="2"
					>
						<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
					</svg>
				</span>
			</button>
		</div>
		<!-- Body -->
		<div class="toast__body">
			<p>
				Unlock <a href="https://astro.build/themes/details/foxi-pro/" target="_blank">Foxi Pro</a> â€”
				CMS, multilingual, animations, and advanced UI. View all available themes from <a href="https://oxygenna.com/themes" target="_blank">Oxygenna</a>.
			</p>
		</div>
		<!-- Actions -->
		<div class="toast__actions"></div>
	</div>
</div>

<style>
	.toast {
		position: fixed;
		bottom: 1rem;
		right: 1rem;
		z-index: 50;
	}
	
	.toast__container {
		display: flex;
		max-height: 95vh;
		width: 20rem;
		max-width: 100%;
		transform: translateY(1rem);
		flex-direction: column;
		overflow: hidden;
		border-radius: 0.25rem;
		background-color: rgb(var(--color-primary-500) / 0.8);
		padding-left: 1rem;
		padding-right: 1rem;
		padding-top: 0.75rem;
		padding-bottom: 0.75rem;
		font-size: 0.875rem;
		line-height: 1.25rem;
		color: rgb(255 255 255);
		opacity: 0;
		box-shadow: 0 10px 15px -3px rgb(var(--color-primary-400) / 0.2), 0 4px 6px -4px rgb(var(--color-primary-400) / 0.2);
		box-shadow: 0 0 0 1px inset rgb(var(--color-primary-700));
		backdrop-filter: blur(4px);
		transition-property: all;
		transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
		transition-duration: 500ms;
	}
	
	:global(.dark) .toast__container {
		box-shadow: 0 0 0 1px inset rgb(var(--color-primary-400));
	}
	
	.toast--show .toast__container {
		animation: fadeUp 0.3s ease-out;
	}
	
	.toast__heading {
		margin-bottom: 0;
		display: flex;
		align-items: center;
		gap: 1rem;
	}
	
	.toast__headline {
		margin-bottom: 0;
		flex: 1 1 0%;
		font-size: 1rem;
		line-height: 1.5rem;
		font-weight: 600;
		color: rgb(255 255 255);
	}
	
	.toast__close-button {
		display: inline-flex;
		height: 2rem;
		align-items: center;
		justify-content: center;
		gap: 0.5rem;
		justify-self: center;
		white-space: nowrap;
		border-radius: 9999px;
		padding-left: 1rem;
		padding-right: 1rem;
		font-size: 0.75rem;
		line-height: 1rem;
		font-weight: 500;
		letter-spacing: 0.025em;
		color: rgb(255 255 255);
		transition-property: all;
		transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
		transition-duration: 300ms;
	}
	
	.toast__close-button:hover {
		background-color: rgb(var(--color-primary-50));
		color: rgb(var(--color-primary-600));
	}
	
	.toast__close-button:focus {
		background-color: rgb(var(--color-primary-100));
		color: rgb(var(--color-primary-700));
	}
	
	.toast__close-button:focus-visible {
		outline: 2px solid transparent;
		outline-offset: 2px;
	}
	
	.toast__close-button:disabled {
		cursor: not-allowed;
		color: rgb(var(--color-primary-600));
		box-shadow: none;
	}
	
	.toast__close-button:disabled:hover {
		background-color: transparent;
	}
	
	.toast__close-button-icon {
		position: relative;
	}
	
	.toast__close-button-icon:only-child {
		margin-left: -1rem;
		margin-right: -1rem;
	}
	
	.toast__body {
		font-size: 0.875rem;
		line-height: 1.25rem;
		color: rgb(255 255 255 / 0.8);
	}
	
	.toast__body :global(a) {
		font-weight: 700;
		color: rgb(255 255 255);
		text-decoration: underline;
	}
	
	.toast__body :global(p) {
		margin-bottom: 0;
	}
	
	.toast__actions {
		margin-top: 1rem;
		display: flex;
		gap: 1rem;
		padding-bottom: 0.25rem;
	}
	
	.toast__actions:empty {
		display: none;
	}
</style>

<script is:inline>
	function initializeToast() {
		const toast = document.getElementById('foxi-toast')
		const closeButton = document.getElementById('foxi-toast-close')

		if (!toast) return // Don't run if toast isn't present

		// Function to show the toast
		function showToast() {
			toast.style.display = 'block'
			toast.classList.add('toast--show')
		}

		// Function to hide the toast and store dismissal time
		function hideToast() {
			toast.style.display = 'none'
			localStorage.setItem('foxiToastDismissed', Date.now())
			toast.classList.remove('toast--show')
		}

		// Check if toast should be shown
		function checkToastEligibility() {
			const lastDismissed = localStorage.getItem('foxiToastDismissed')

			if (!lastDismissed) {
				setTimeout(showToast, 3000)
				return
			}

			const twoSecondsInMs = 7 * 24 * 60 * 60 * 1000
			const timeSinceDismissal = Date.now() - parseInt(lastDismissed)

			if (timeSinceDismissal >= twoSecondsInMs) {
				setTimeout(showToast, 3000)
			}
		}

		// Initialize
		checkToastEligibility()

		// Close button click handler
		if (closeButton) {
			closeButton.addEventListener('click', hideToast)
		}
	}

	// Run once on initial page load
	document.addEventListener('DOMContentLoaded', initializeToast)

	// Run again on Astro SPA-style page loads
	document.addEventListener('astro:page-loaded', initializeToast)
	document.addEventListener('astro:after-swap', initializeToast)
</script>
